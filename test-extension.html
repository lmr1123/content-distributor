<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ‰©å±•åŠŸèƒ½æµ‹è¯•</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .test-card {
      background: white;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 { color: #6366f1; }
    h2 { color: #333; margin-top: 0; }
    .test-item {
      padding: 10px;
      margin: 10px 0;
      border-left: 4px solid #ddd;
      background: #f9f9f9;
    }
    .test-item.pass { border-color: #22c55e; }
    .test-item.fail { border-color: #ef4444; }
    .btn {
      background: #6366f1;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    .btn:hover { background: #4f46e5; }
    .result {
      margin-top: 10px;
      padding: 10px;
      background: #f0f9ff;
      border-radius: 4px;
      font-family: monospace;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h1>ğŸ§ª å…¨å¹³å°å†…å®¹åˆ†å‘åŠ©æ‰‹ - åŠŸèƒ½æµ‹è¯•</h1>

  <div class="test-card">
    <h2>ğŸ“‹ æ–‡ä»¶ç»“æ„æ£€æŸ¥</h2>
    <button class="btn" onclick="checkFiles()">æ£€æŸ¥æ–‡ä»¶</button>
    <div id="fileResult" class="result"></div>
  </div>

  <div class="test-card">
    <h2>ğŸ”§ Manifest éªŒè¯</h2>
    <button class="btn" onclick="checkManifest()">éªŒè¯é…ç½®</button>
    <div id="manifestResult" class="result"></div>
  </div>

  <div class="test-card">
    <h2>ğŸ“ æ¨¡æ‹Ÿæ–‡ç« æå–</h2>
    <p>æµ‹è¯•å†…å®¹æå–é€»è¾‘ï¼ˆä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼‰</p>
    <button class="btn" onclick="testExtraction()">è¿è¡Œæµ‹è¯•</button>
    <div id="extractionResult" class="result"></div>
  </div>

  <div class="test-card">
    <h2>ğŸ¨ UI æ¸²æŸ“æµ‹è¯•</h2>
    <p>æ£€æŸ¥ä¸»é¡µé¢æ˜¯å¦å¯ä»¥æ­£å¸¸åŠ è½½</p>
    <button class="btn" onclick="testUI()">æµ‹è¯• UI</button>
    <div id="uiResult" class="result"></div>
  </div>

  <div class="test-card">
    <h2>âœ… å®‰è£…å‡†å¤‡æ£€æŸ¥</h2>
    <button class="btn" onclick="finalCheck()">å®Œæ•´æ£€æŸ¥</button>
    <div id="finalResult" class="result"></div>
  </div>

  <script>
    const requiredFiles = [
      'manifest.json',
      'js/background.js',
      'js/distributor.js',
      'css/distributor.css',
      'pages/distributor.html',
      'icons/icon16.png',
      'icons/icon48.png',
      'icons/icon128.png',
      'js/content-scripts/xiaohongshu.js',
      'js/content-scripts/zhihu.js',
      'js/content-scripts/universal.js'
    ];

    async function checkFiles() {
      const result = document.getElementById('fileResult');
      result.textContent = 'æ­£åœ¨æ£€æŸ¥æ–‡ä»¶...\n';

      for (const file of requiredFiles) {
        try {
          const response = await fetch(file);
          if (response.ok) {
            result.textContent += `âœ… ${file}\n`;
          } else {
            result.textContent += `âŒ ${file} - æœªæ‰¾åˆ°\n`;
          }
        } catch (e) {
          result.textContent += `âŒ ${file} - é”™è¯¯\n`;
        }
      }
    }

    async function checkManifest() {
      const result = document.getElementById('manifestResult');
      try {
        const response = await fetch('manifest.json');
        const manifest = await response.json();

        let output = 'Manifest é…ç½®æ£€æŸ¥:\n\n';
        output += `åç§°: ${manifest.name}\n`;
        output += `ç‰ˆæœ¬: ${manifest.version}\n`;
        output += `Manifest ç‰ˆæœ¬: ${manifest.manifest_version}\n\n`;

        output += `æƒé™:\n`;
        manifest.permissions.forEach(p => output += `  - ${p}\n`);

        output += `\nContent Scripts:\n`;
        manifest.content_scripts.forEach(cs => {
          output += `  - åŒ¹é…: ${cs.matches.join(', ')}\n`;
        });

        output += `\nâœ… Manifest æ ¼å¼æ­£ç¡®`;
        result.textContent = output;
      } catch (e) {
        result.textContent = 'âŒ Manifest è§£æå¤±è´¥: ' + e.message;
      }
    }

    function testExtraction() {
      const result = document.getElementById('extractionResult');

      // æ¨¡æ‹Ÿå¾®ä¿¡æ–‡ç« HTML
      const mockHTML = `
        <div id="activity-name">æµ‹è¯•æ–‡ç« æ ‡é¢˜</div>
        <div id="js_name">æµ‹è¯•å…¬ä¼—å·</div>
        <div id="js_content">
          <p>è¿™æ˜¯ç¬¬ä¸€æ®µå†…å®¹</p>
          <p>è¿™æ˜¯ç¬¬äºŒæ®µå†…å®¹</p>
          <img src="test.jpg" />
        </div>
      `;

      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = mockHTML;

      const article = {
        title: tempDiv.querySelector('#activity-name')?.textContent || '',
        author: tempDiv.querySelector('#js_name')?.textContent || '',
        content: tempDiv.querySelector('#js_content')?.innerHTML || ''
      };

      let output = 'æ¨¡æ‹Ÿæ–‡ç« æå–ç»“æœ:\n\n';
      output += `æ ‡é¢˜: ${article.title}\n`;
      output += `ä½œè€…: ${article.author}\n`;
      output += `å†…å®¹é•¿åº¦: ${article.content.length} å­—ç¬¦\n\n`;

      if (article.title && article.author && article.content) {
        output += 'âœ… å†…å®¹æå–é€»è¾‘æ­£å¸¸';
      } else {
        output += 'âš ï¸ éƒ¨åˆ†å†…å®¹æå–å¤±è´¥';
      }

      result.textContent = output;
    }

    async function testUI() {
      const result = document.getElementById('uiResult');
      try {
        const response = await fetch('pages/distributor.html');
        const html = await response.text();

        let output = 'UI æ£€æŸ¥ç»“æœ:\n\n';
        output += `æ–‡ä»¶å¤§å°: ${html.length} å­—ç¬¦\n`;

        const checks = [
          { name: 'Quill ç¼–è¾‘å™¨å¼•ç”¨', test: html.includes('quilljs.com') },
          { name: 'ç¼–è¾‘å™¨å®¹å™¨', test: html.includes('id="editor"') },
          { name: 'å¹³å°é€‰æ‹©', test: html.includes('platform-item') },
          { name: 'åŒæ­¥æŒ‰é’®', test: html.includes('syncBtn') },
          { name: 'æ ·å¼è¡¨å¼•ç”¨', test: html.includes('distributor.css') }
        ];

        checks.forEach(check => {
          output += `${check.test ? 'âœ…' : 'âŒ'} ${check.name}\n`;
        });

        result.textContent = output;
      } catch (e) {
        result.textContent = 'âŒ åŠ è½½å¤±è´¥: ' + e.message;
      }
    }

    async function finalCheck() {
      const result = document.getElementById('finalResult');
      result.textContent = 'æ­£åœ¨è¿›è¡Œå®Œæ•´æ£€æŸ¥...\n\n';

      let allPass = true;

      // æ£€æŸ¥æ–‡ä»¶
      let filesOK = true;
      for (const file of requiredFiles) {
        try {
          const response = await fetch(file);
          if (!response.ok) filesOK = false;
        } catch (e) {
          filesOK = false;
        }
      }
      result.textContent += filesOK ? 'âœ… æ‰€æœ‰å¿…éœ€æ–‡ä»¶å­˜åœ¨\n' : 'âŒ ç¼ºå°‘å¿…éœ€æ–‡ä»¶\n';
      allPass = allPass && filesOK;

      // æ£€æŸ¥ Manifest
      try {
        const response = await fetch('manifest.json');
        const manifest = await response.json();
        const manifestOK = manifest.manifest_version === 3 &&
                          manifest.permissions.length > 0 &&
                          manifest.content_scripts.length > 0;
        result.textContent += manifestOK ? 'âœ… Manifest é…ç½®æ­£ç¡®\n' : 'âŒ Manifest é…ç½®æœ‰è¯¯\n';
        allPass = allPass && manifestOK;
      } catch (e) {
        result.textContent += 'âŒ Manifest è§£æå¤±è´¥\n';
        allPass = false;
      }

      result.textContent += '\n' + (allPass ?
        'ğŸ‰ å‡†å¤‡å°±ç»ªï¼å¯ä»¥å®‰è£…åˆ° Chrome æµè§ˆå™¨' :
        'âš ï¸ å­˜åœ¨é—®é¢˜ï¼Œè¯·æ£€æŸ¥ä¸Šè¿°é”™è¯¯');

      result.textContent += '\n\nå®‰è£…æ­¥éª¤:\n';
      result.textContent += '1. æ‰“å¼€ chrome://extensions/\n';
      result.textContent += '2. å¯ç”¨"å¼€å‘è€…æ¨¡å¼"\n';
      result.textContent += '3. ç‚¹å‡»"åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº"\n';
      result.textContent += '4. é€‰æ‹© content-distributor æ–‡ä»¶å¤¹';
    }
  </script>
</body>
</html>
